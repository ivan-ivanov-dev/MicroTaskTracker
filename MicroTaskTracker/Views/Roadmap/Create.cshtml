@using MicroTaskTracker.Models.ViewModels.Roadmaps
@model RoadmapCreateViewModel

<div class="container mt-4">
    <h2>Design Your Roadmap</h2>
    <hr />

    <form id="roadmapForm" asp-action="Create" method="post">
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light"><h4>Step 1: The Goal</h4></div>
            <div class="card-body">
                @if (Model.SelectedGoalId.HasValue)
                {
                    <input type="hidden" asp-for="SelectedGoalId" />
                    <div class="form-group">
                        <label>Goal Title</label>
                        <input asp-for="NewGoalTitle" class="form-control" readonly />
                    </div>
                    <div class="form-group mt-2">
                        <label>Description</label>
                        <textarea asp-for="NewGoalDescription" class="form-control" readonly></textarea>
                    </div>
                }
                else
                {
                    <div class="form-group">
                        <label>New Goal Title</label>
                        <input asp-for="NewGoalTitle" class="form-control" placeholder="e.g., Master C# Programming" />
                        <span asp-validation-for="NewGoalTitle" class="text-danger"></span>
                    </div>
                    <div class="form-group mt-2">
                        <label>Short Description</label>
                        <textarea asp-for="NewGoalDescription" class="form-control" placeholder="What is this goal about?"></textarea>
                    </div>
                }
            </div>
        </div>

        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light"><h4>Step 2: The "Why" & Outcome</h4></div>
            <div class="card-body">
                <div class="form-group">
                    <label>Why is this goal important to you?</label>
                    <textarea asp-for="Why" class="form-control" rows="3" placeholder="Deep reflection here..."></textarea>
                    <span asp-validation-for="Why" class="text-danger"></span>
                </div>
                <div class="form-group mt-3">
                    <label>What is the Ideal Outcome?</label>
                    <textarea asp-for="IdealOutcome" class="form-control" rows="3" placeholder="Describe the finished result..."></textarea>
                    <span asp-validation-for="IdealOutcome" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-light d-flex justify-content-between">
                <h4>Step 3: Action Items</h4>
            </div>
            <div class="card-body" id="actionItemsContainer">
                @for (int i = 0; i < Model.Actions.Count; i++)
                {
                    <div class="action-item-block border p-3 mb-3 rounded bg-white">
                        <h5>Action #@(i + 1)</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <label>Action Title</label>
                                <input asp-for="Actions[i].Title" class="form-control" placeholder="What needs to be done?" />
                            </div>
                            <div class="col-md-6">
                                <label>Completion Date</label>
                                <input asp-for="Actions[i].DueDate" type="date" class="form-control" />
                            </div>
                        </div>
                        <div class="mt-2">
                            <label>Resources Needed</label>
                            <input asp-for="Actions[i].Resources" class="form-control" placeholder="Books, links, tools..." />
                        </div>
                    </div>
                }
            </div>
        </div>

        <button type="button" class="btn btn-success btn-lg w-100" onclick="showConfirmModal()">
            Confirm Roadmap
        </button>
    </form>
</div>

<div class="modal fade" id="confirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Ready to commit?</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Everything looks great! Do you want to save this roadmap and start working, or continue editing your plan?</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Continue Editing</button>
                <button type="button" class="btn btn-primary" onclick="submitForm()">Save Roadmap</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function showConfirmModal() {
            // You could add validation checks here if you want
            var myModal = new bootstrap.Modal(document.getElementById('confirmModal'));
            myModal.show();
        }

        function submitForm() {
            document.getElementById('roadmapForm').submit();
        }
    </script>
}